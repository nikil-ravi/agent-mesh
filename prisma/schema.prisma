generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

model User {
  id            String   @id @default(cuid())
  name          String?
  email         String?  @unique
  emailVerified DateTime?
  image         String?
  accounts      Account[]
  sessions      Session[]
  profile       Profile?
  participants  RoomParticipant[]
  opportunitiesA Opportunity[] @relation("OpportunityUserA")
  opportunitiesB Opportunity[] @relation("OpportunityUserB")
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
}

model Account {
  id                String  @id @default(cuid())
  userId            String
  type              String
  provider          String
  providerAccountId String
  refresh_token     String?
  access_token      String?
  expires_at        Int?
  token_type        String?
  scope             String?
  id_token          String?
  session_state     String?
  user User @relation(fields: [userId], references: [id], onDelete: Cascade)
  @@unique([provider, providerAccountId])
}

model Session {
  id           String   @id @default(cuid())
  sessionToken String   @unique
  userId       String
  expires      DateTime
  user User @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model VerificationToken {
  identifier String
  token      String   @unique
  expires    DateTime
  @@unique([identifier, token])
}

model Profile {
  id         String @id @default(cuid())
  userId     String @unique
  headline   String?
  bio        String?
  interests  String?
  lookingFor String?
  embedding  String?
  user       User @relation(fields: [userId], references: [id], onDelete: Cascade)
  updatedAt  DateTime @updatedAt
  createdAt  DateTime @default(now())
}

model Room {
  id            String @id @default(cuid())
  code          String @unique
  createdById   String
  createdAt     DateTime @default(now())
  participants  RoomParticipant[]
  opportunities Opportunity[]
}

model RoomParticipant {
  id       String @id @default(cuid())
  roomId   String
  userId   String
  joinedAt DateTime @default(now())
  room Room @relation(fields: [roomId], references: [id], onDelete: Cascade)
  user User @relation(fields: [userId], references: [id], onDelete: Cascade)
  @@unique([roomId, userId])
}

model Opportunity {
  id         String @id @default(cuid())
  roomId     String
  userAId    String
  userBId    String
  status     String @default("PROPOSED")
  decisionA  String @default("UNKNOWN")
  decisionB  String @default("UNKNOWN")
  score      Float?
  rationale  String?
  transcript String?
  introToA   String?
  introToB   String?
  questionA  String?
  questionB  String?
  answerA    String?
  answerB    String?
  emailedAAt DateTime?
  emailedBAt DateTime?
  acceptedEmailedAAt DateTime?
  acceptedEmailedBAt DateTime?
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt
  room       Room @relation(fields: [roomId], references: [id], onDelete: Cascade)
  userA      User @relation("OpportunityUserA", fields: [userAId], references: [id], onDelete: Cascade)
  userB      User @relation("OpportunityUserB", fields: [userBId], references: [id], onDelete: Cascade)
  @@unique([roomId, userAId, userBId])
}


